<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="game-title">Luy·ªán T·∫≠p M√¥ T·∫£ Ngo·∫°i H√¨nh ƒê·ªông V·∫≠t</title>
    <!-- T·∫£i Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        
        /* ƒê·∫£m b·∫£o ·ª©ng d·ª•ng v·ª´a v·∫∑n v·ªõi m√†n h√¨nh */
        html, body {
            height: 100%; 
            margin: 0;
            padding: 0;
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fd; 
        }

        .game-wrapper {
            display: flex;
            justify-content: center;
            align-items: center; 
            min-height: 100vh; 
            padding: 0.5rem;
            box-sizing: border-box;
        }

        /* --- GLOBAL GAME CONTAINER STYLE --- */
        .game-card {
            max-width: 768px; 
            width: 100%;
            max-height: 98vh; 
            overflow-y: auto; 
            background-color: white;
            padding: 1.5rem; 
            border-radius: 1.5rem;
            box-shadow: 0 5px 20px rgba(100, 100, 100, 0.1);
            border-top: 6px solid #3b82f6; /* M√†u Blue cho theme ch√≠nh */
        }
        
        /* --- WORD PILLS (VI√äN G·∫†CH T·ª™) STYLE --- */
        .word-pill {
            cursor: grab;
            transition: transform 0.15s, box-shadow 0.15s, background-color 0.2s;
            padding: 0.75rem 1rem; 
            font-size: 1rem; 
            font-weight: 700; 
            border-radius: 9999px; /* Pill shape */
            background-color: #60a5fa; /* Blue-400 color */
            color: white;
            box-shadow: 0 4px 6px rgba(96, 165, 250, 0.5);
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0.4rem; 
            flex-shrink: 0;
        }
        
        /* Styling cho d·∫•u ch·∫•m c√¢u */
        .word-pill[data-is-punctuation="true"] {
            background-color: #f97316; /* Orange for punctuation */
            padding: 0.5rem 0.75rem;
            box-shadow: 0 4px 6px rgba(249, 115, 22, 0.5);
        }

        .word-pill:active {
            cursor: grabbing;
            transform: scale(1.05);
            box-shadow: 0 6px 12px rgba(96, 165, 250, 0.7);
        }
        .word-pill.dragging {
            opacity: 0.4;
        }
        
        /* --- DROP ZONE (√î TH·∫¢) STYLE --- */
        .drop-zone {
            min-width: 4rem; 
            height: 3.5rem;
            border: 3px dashed #bfdbfe; /* Light blue dashed border */
            background-color: #eff6ff; /* Very light blue background */
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            margin: 0.4rem; 
            padding: 2px;
            flex-grow: 1; 
            min-height: 3rem;
        }
        
        /* Style for occupied drop zone pills (draggable content) */
        .drop-zone .word-pill {
            margin: 0;
            box-shadow: none; 
            background-color: #2563eb; /* Darker blue for dropped words */
            cursor: pointer; 
        }
        .drop-zone .word-pill[data-is-punctuation="true"] {
            background-color: #ea580c; /* Darker orange for dropped punctuation */
        }

        @keyframes shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }
        
        @keyframes pop-in {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }
        .animate-pop-in {
            animation: pop-in 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
    </style>
</head>
<body>
    <div class="game-wrapper">
        <div class="game-card">
            
            <!-- Header & Timer -->
            <header class="flex flex-col sm:flex-row sm:justify-between items-center mb-4 pt-2">
                <h1 id="header-title" class="text-xl sm:text-3xl font-extrabold text-[#3b82f6] mb-2 sm:mb-0 text-center sm:text-left">
                    <!-- Ti√™u ƒë·ªÅ -->
                </h1>
                <div class="flex items-center space-x-3">
                    <!-- Timer Display -->
                    <div class="text-base sm:text-lg font-bold text-gray-700 p-2 bg-yellow-100 rounded-lg shadow-inner">
                        <span id="timer-icon" role="img" aria-label="ƒê·ªìng h·ªì">‚è±Ô∏è</span>
                        <span id="timer-display">00:00</span>
                    </div>
                </div>
            </header>

            <!-- Instructions -->
            <p id="instructions" class="text-sm sm:text-lg text-gray-600 font-medium mb-4 p-2 border-l-4 border-indigo-500 bg-indigo-50 rounded-md">
                <!-- H∆∞·ªõng d·∫´n -->
            </p>

            <!-- PROGRESS BAR -->
            <div class="mb-4">
                <div class="flex justify-between mb-1 text-xs sm:text-sm font-medium text-gray-700">
                    <span id="progress-text-label">Ti·∫øn ƒë·ªô</span>
                    <span id="progress-text">0 / 5</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2.5">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full transition-all duration-300" style="width: 0%"></div>
                </div>
            </div>

            <!-- CURRENT SENTENCE DISPLAY AREA -->
            <div class="flex flex-col items-center justify-center p-4 bg-blue-50 rounded-xl border border-blue-200 mb-6 min-h-[10rem]">
                
                <!-- Icon Hint -->
                <div id="sentence-icon" class="text-6xl sm:text-8xl mb-4"></div>
                
                <!-- Drop Zones (Flex wrap for responsiveness) -->
                <div id="drop-zone-container" class="flex flex-wrap justify-center items-center py-2 min-h-[4rem] w-full">
                    <!-- √î th·∫£ ƒë∆∞·ª£c t·∫°o t·∫°i ƒë√¢y -->
                </div>
            </div>

            <!-- Word Bank (Kho T·ª´) -->
            <h2 id="bank-title" class="text-base sm:text-xl font-bold text-gray-700 mb-3 p-2 bg-purple-100 rounded-lg border-l-4 border-purple-500">
                Kho T·ª´: K√©o v√† Th·∫£ ƒë·ªÉ S·∫Øp x·∫øp C√¢u
            </h2>
            <div id="word-bank" class="flex flex-wrap justify-center p-3 bg-purple-50 rounded-xl shadow-inner min-h-[5rem] mb-6"
                ondragover="handleDragOver(event)"
                ondrop="handleDrop(event)">
                <!-- C√°c t·ª´ ƒë√£ x√°o tr·ªôn ƒë∆∞·ª£c t·∫°o t·∫°i ƒë√¢y -->
            </div>

            <!-- Action Area (Mobile: Stacked buttons) -->
            <div class="flex flex-col sm:flex-row justify-center space-y-2 sm:space-y-0 sm:space-x-4 mt-6">
                <button id="try-again-button" class="px-6 py-3 bg-red-500 text-white font-bold text-base rounded-xl shadow-lg hover:bg-red-600 transition transform hover:scale-[1.02]">
                    Th·ª≠ L·∫°i / X√≥a T·ª´ ƒë√£ Th·∫£
                </button>
                <button id="check-button" class="px-6 py-3 bg-blue-600 text-white font-bold text-base rounded-xl shadow-lg hover:bg-blue-700 transition transform hover:scale-[1.02]">
                    Ki·ªÉm tra C√¢u
                </button>
            </div>
            
            <!-- Feedback Message -->
            <div id="feedback-message" class="text-center mt-3 text-lg font-bold min-h-[2rem]"></div>
        </div>
    </div>

    <!-- Winning Modal -->
    <div id="winning-modal" class="hidden fixed inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-white p-8 rounded-3xl shadow-2xl max-w-sm w-full text-center border-t-8 border-blue-500 animate-pop-in">
            <div class="text-7xl mb-4 animate-bounce">üéâüèÜüéä</div>
            <h2 id="modal-title" class="text-3xl font-extrabold text-blue-700 mb-3">Ho√†n th√†nh Xu·∫•t s·∫Øc!</h2>
            <p id="modal-text" class="text-lg text-gray-600 mb-5">
                B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c c√¢u trong: 
                <span id="final-time" class="text-blue-600 font-extrabold">00:00</span>
            </p>
            <button id="modal-close-button" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 transition transform hover:scale-105 shadow-md" onclick="window.location.reload()">
                Ch∆°i L·∫°i
            </button>
        </div>
    </div>

    <script>
        // --- CUSTOMIZABLE INPUTS ---
        
        const TITLE = "Luy·ªán T·∫≠p M√¥ T·∫£ Ngo·∫°i H√¨nh ƒê·ªông V·∫≠t";
        const INSTRUCTION_LANGUAGE = "Vietnamese";

        // Danh s√°ch c√¢u c·ª• th·ªÉ (C√¢u s·ªë nhi·ªÅu ƒë∆∞·ª£c minh h·ªça b·∫±ng 2 emoji)
        const sentences = [
            { id: 1, sentence: "The monkeys are little.", icon: "üêíüêí" }, // S·ªë nhi·ªÅu
            { id: 2, sentence: "The elephant is big and gray.", icon: "üêò" }, // S·ªë √≠t
            { id: 3, sentence: "The tiger has orange and black stripes.", icon: "üêÖ" }, // S·ªë √≠t
            { id: 4, sentence: "The giraffe has a long neck.", icon: "ü¶í" }, // S·ªë √≠t
            { id: 5, sentence: "The parrots are colourful.", icon: "ü¶úü¶ú" } // S·ªë nhi·ªÅu
        ];
        
        // --- LANGUAGE DATA (Vietnamese UI) ---
        const languageData = {
            'Vietnamese': {
                title: TITLE,
                instructions: 'S·∫Øp x·∫øp c√°c t·ª´ v√† d·∫•u ch·∫•m c√¢u ƒë·ªÉ t·∫°o th√†nh c√¢u m√¥ t·∫£ ngo·∫°i h√¨nh ƒë·ªông v·∫≠t ho√†n ch·ªânh. L∆∞u √Ω: H√¨nh minh h·ªça emoji ph·∫£n √°nh s·ªë l∆∞·ª£ng (s·ªë √≠t / s·ªë nhi·ªÅu).',
                bankTitle: 'Kho T·ª´: K√©o v√† Th·∫£ ƒë·ªÉ S·∫Øp x·∫øp C√¢u',
                checkButton: 'Ki·ªÉm tra C√¢u',
                tryAgainButton: 'Th·ª≠ L·∫°i / X√≥a T·ª´ ƒë√£ Th·∫£',
                progressLabel: 'C√¢u',
                feedbackCorrect: 'üéâ Ch√≠nh x√°c! Tuy·ªát v·ªùi.',
                feedbackIncorrect: '‚ùå Sai r·ªìi. Ki·ªÉm tra l·∫°i th·ª© t·ª± t·ª´, ch·ªØ hoa ƒë·∫ßu c√¢u v√† d·∫•u ch·∫•m c√¢u.',
                feedbackMissing: 'Vui l√≤ng ƒëi·ªÅn ƒë·ªß t·∫•t c·∫£ c√°c √¥ t·ª´.',
                modalTitle: 'Ho√†n th√†nh Xu·∫•t s·∫Øc!',
                modalText: (time) => `B·∫°n ƒë√£ ho√†n th√†nh t·∫•t c·∫£ c√°c c√¢u trong: ${time}.`,
                modalButton: 'Ch∆°i L·∫°i',
            }
        };

        // --- GLOBAL STATE ---
        const $ = selector => document.querySelector(selector);
        const $$ = selector => document.querySelectorAll(selector);
        let currentLanguage = INSTRUCTION_LANGUAGE;
        let currentSentenceIndex = 0;
        let timerInterval = null;
        let startTime = Date.now(); 
        
        // --- UTILITIES ---

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
        
        // T√°ch c√¢u th√†nh c√°c t·ª´/c·ª•m t·ª´ v√† d·∫•u ch·∫•m
        function splitSentenceToWords(sentence) {
            // T√°ch d·∫•u ch·∫•m cu·ªëi c√πng th√†nh m·ªôt t·ª´ ri√™ng bi·ªát n·∫øu n√≥ t·ªìn t·∫°i
            const match = sentence.match(/([.,!?;])( *?)$/);
            if (match) {
                const punctuation = match[1]; // D·∫•u ch·∫•m
                const restOfSentence = sentence.substring(0, match.index).trim();
                // S·ª≠ d·ª•ng regex ƒë·ªÉ t√°ch t·ª´/c·ª•m t·ª´ (bao g·ªìm c·∫£ c√°c t·ª´ c√≥ d·∫•u nh√°y ƒë∆°n nh∆∞ doesn‚Äôt, are, v.v.)
                const words = restOfSentence.match(/\b[\w‚Äô]+\b|[\w‚Äô]+/g) || [];
                words.push(punctuation);
                return words;
            } else {
                return sentence.match(/\b[\w‚Äô]+\b|[\w‚Äô]+/g) || [];
            }
        }

        // L·∫•y c√¢u ƒë√£ s·∫Øp x·∫øp t·ª´ c√°c drop zone
        function getCurrentGuessedSentence() {
            const dropZones = $$('#drop-zone-container .drop-zone');
            let words = [];
            dropZones.forEach(zone => {
                const pill = zone.querySelector('.word-pill');
                if (pill) {
                    words.push(pill.textContent);
                }
            });
            // N·ªëi l·∫°i th√†nh c√¢u ƒë·ªÉ ki·ªÉm tra nghi√™m ng·∫∑t
            return words.join(' ').replace(/\s([.,!?;])/g, '$1'); 
        }

        // --- UI & TIMER FUNCTIONS ---

        function updateTimerDisplay() {
            const elapsed = Date.now() - startTime;
            const totalSeconds = Math.floor(elapsed / 1000);
            const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, '0');
            const seconds = String(totalSeconds % 60).padStart(2, '0');
            $('#timer-display').textContent = `${minutes}:${seconds}`;
        }

        function startTimer() {
            if (!timerInterval) {
                startTime = Date.now();
                timerInterval = setInterval(updateTimerDisplay, 1000);
            }
        }
        
        function updateProgress() {
            const total = sentences.length;
            const current = currentSentenceIndex;
            
            const displayIndex = Math.min(current + 1, total);
            $('#progress-text').textContent = `${displayIndex} / ${total}`;
            
            const percent = ((current + 1) / total) * 100;
            $('#progress-bar').style.width = `${percent}%`;
        }
        
        function clearFeedback() {
            const feedbackEl = $('#feedback-message');
            feedbackEl.textContent = '';
            feedbackEl.classList.remove('text-green-600', 'text-red-600');
            
            // X√≥a hi·ªáu ·ª©ng l·∫Øc v√† highlight
            $$('.drop-zone').forEach(zone => {
                zone.style.animation = 'none';
                zone.style.borderColor = '';
                zone.style.backgroundColor = '';
                const pill = zone.querySelector('.word-pill');
                if(pill) pill.style.backgroundColor = '';
            });
        }
        
        function updateUI() {
            const data = languageData[currentLanguage];
            
            $('#header-title').textContent = data.title;
            $('#instructions').textContent = data.instructions;
            
            $('#check-button').textContent = data.checkButton;
            $('#try-again-button').textContent = data.tryAgainButton;
            $('#progress-text-label').textContent = data.progressLabel;
            
            // C·∫≠p nh·∫≠t n·ªôi dung Modal
            const finalTime = $('#timer-display').textContent;
            $('#modal-title').textContent = data.modalTitle;
            $('#modal-close-button').textContent = data.modalButton;
            $('#final-time').textContent = finalTime;
            $('#modal-text').textContent = data.modalText(finalTime);
            
            updateProgress();
            clearFeedback();
        }

        // --- DRAG AND DROP HANDLERS ---
        
        let draggedPill = null; 

        function handleDragStart(e) {
            const pill = e.target.closest('.word-pill');
            if (!pill) return;
            
            draggedPill = pill; 
            e.dataTransfer.setData('text/plain', pill.dataset.word);
            e.dataTransfer.effectAllowed = 'move';
            pill.classList.add('dragging');
            clearFeedback();
        }

        function handleDragEnd(e) {
            if (draggedPill) {
                draggedPill.classList.remove('dragging');
            }
            draggedPill = null;
        }

        function handleDragOver(e) {
            e.preventDefault();
            const target = e.target.closest('.drop-zone') || e.target.closest('#word-bank');
            
            // Highlight √¥ th·∫£ h·ª£p l·ªá
            $$('.drop-zone').forEach(zone => zone.classList.remove('opacity-70'));
            
            if (target && target.classList.contains('drop-zone') && !target.querySelector('.word-pill')) { 
                target.classList.add('opacity-70'); 
            }
            e.dataTransfer.dropEffect = 'move';
        }

        function handleDrop(e) {
            e.preventDefault();
            $$('.drop-zone').forEach(zone => zone.classList.remove('opacity-70'));
            
            const targetDropZone = e.target.closest('.drop-zone');
            const wordBank = $('#word-bank');
            
            if (!draggedPill) return; 
            const pillToMove = draggedPill;

            // 1. Th·∫£ v√†o √î th·∫£ (Slots)
            if (targetDropZone && !targetDropZone.querySelector('.word-pill')) {
                pillToMove.parentNode.removeChild(pillToMove);
                
                targetDropZone.appendChild(pillToMove);
                pillToMove.classList.remove('dragging');
            } 
            // 2. Th·∫£ v√†o Kho T·ª´ (Tr·∫£ l·∫°i t·ª´ √¥ th·∫£)
            else if (e.target === wordBank || wordBank.contains(e.target)) {
                if (pillToMove.parentNode && pillToMove.parentNode.classList.contains('drop-zone')) {
                    const oldDropZone = pillToMove.parentNode;
                    oldDropZone.removeChild(pillToMove);
                    
                    // T·∫°o th·∫ª t·ª´ m·ªõi v√† ƒë∆∞a v√†o ng√¢n h√†ng
                    const newPill = createWordPill(pillToMove.dataset.word);
                    wordBank.appendChild(newPill);
                }
                pillToMove.classList.remove('dragging');
            } else {
                 pillToMove.classList.remove('dragging');
            }

            draggedPill = null;
        }

        // Click v√†o t·ª´ trong √¥ th·∫£ ƒë·ªÉ tr·∫£ n√≥ v·ªÅ ng√¢n h√†ng
        function handleSlotClick(e) {
            const pill = e.target.closest('.word-pill');
            if (!pill) return;

            const dropZone = pill.parentNode;
            if (dropZone.classList.contains('drop-zone')) {
                dropZone.removeChild(pill);
                
                // T·∫°o th·∫ª t·ª´ m·ªõi v√† ƒë∆∞a v√†o ng√¢n h√†ng
                const newPill = createWordPill(pill.dataset.word);
                $('#word-bank').appendChild(newPill);
                
                clearFeedback();
            }
        }
        
        // --- RENDER & LOGIC FUNCTIONS ---
        
        function createWordPill(word) {
            const pill = document.createElement('div');
            pill.textContent = word; 
            
            let isPunctuation = false;
            // Ki·ªÉm tra d·∫•u ch·∫•m c√¢u
            if (word === '.' || word === '?' || word === '!' || word === ';' || word === ',') {
                isPunctuation = true;
                pill.classList.add('px-3', 'py-1'); // D·∫•u c√¢u nh·ªè h∆°n
            }
            
            pill.className = 'word-pill';
            pill.draggable = true;
            pill.dataset.word = word; // L∆∞u tr·ªØ t·ª´ g·ªëc ƒë·ªÉ tr√°nh m·∫•t ƒë·ªãnh d·∫°ng trong qu√° tr√¨nh k√©o
            pill.dataset.isPunctuation = isPunctuation;
            
            pill.addEventListener('dragstart', handleDragStart);
            pill.addEventListener('dragend', handleDragEnd);
            pill.addEventListener('click', handleSlotClick); 
            return pill;
        }

        function loadCurrentSentence() {
            clearFeedback();

            if (currentSentenceIndex >= sentences.length) {
                // LOGIC K·∫æT TH√öC TR√í CH∆†I
                clearInterval(timerInterval);
                updateUI(); 
                $('#winning-modal').classList.remove('hidden');
                return; 
            } else {
                // LOGIC T·∫¢I C√ÇU
                const currentItem = sentences[currentSentenceIndex];
                const correctSentence = currentItem.sentence;
                const words = splitSentenceToWords(correctSentence); 
                
                // 1. C·∫≠p nh·∫≠t UI
                $('#sentence-icon').textContent = currentItem.icon;
                updateProgress();
                
                // 2. Render √î th·∫£
                const dropZoneContainer = $('#drop-zone-container');
                dropZoneContainer.innerHTML = '';
                
                for (let i = 0; i < words.length; i++) {
                    const zone = document.createElement('div');
                    zone.className = 'drop-zone';
                    zone.dataset.slotIndex = i;
                    zone.addEventListener('dragover', handleDragOver);
                    zone.addEventListener('drop', handleDrop);
                    dropZoneContainer.appendChild(zone);
                }
                
                // 3. Render Kho T·ª´ ƒë√£ x√°o tr·ªôn
                const wordBank = $('#word-bank');
                wordBank.innerHTML = '';

                shuffleArray(words); // X√°o tr·ªôn m·∫£ng t·ª´

                words.forEach(word => {
                    const pill = createWordPill(word);
                    wordBank.appendChild(pill);
                });
            }
        }
        
        function checkAnswer() {
            if (currentSentenceIndex >= sentences.length) return; 

            const guessedSentence = getCurrentGuessedSentence();
            const correctSentence = sentences[currentSentenceIndex].sentence;
            const data = languageData[currentLanguage];
            
            clearFeedback();
            
            const dropZoneContainer = $('#drop-zone-container');
            const requiredLength = splitSentenceToWords(correctSentence).length;
            const currentParts = $$('.drop-zone .word-pill').length;

            // 1. Ki·ªÉm tra thi·∫øu t·ª´/c·ª•m t·ª´
            if (currentParts !== requiredLength) {
                const feedbackEl = $('#feedback-message');
                feedbackEl.textContent = data.feedbackMissing;
                feedbackEl.classList.add('text-red-600');
                
                dropZoneContainer.style.animation = 'shake 0.3s';
                setTimeout(() => dropZoneContainer.style.animation = 'none', 300);
                return;
            }

            // 2. Ki·ªÉm tra c√¢u ƒë√∫ng (Ki·ªÉm tra nghi√™m ng·∫∑t: c·∫£ ch·ªØ hoa, ch·ªØ th∆∞·ªùng v√† d·∫•u ch·∫•m c√¢u)
            if (guessedSentence === correctSentence) {
                const feedbackEl = $('#feedback-message');
                feedbackEl.textContent = data.feedbackCorrect;
                feedbackEl.classList.add('text-green-600');
                
                // ƒê√°nh d·∫•u c√°c √¥ ƒë√∫ng
                $$('.drop-zone').forEach(zone => {
                    zone.style.borderColor = '#4CAF50'; 
                    zone.style.backgroundColor = '#E8F5E9'; 
                    const pill = zone.querySelector('.word-pill');
                    if(pill) pill.style.backgroundColor = '#4CAF50'; 
                });
                
                // Chuy·ªÉn sang c√¢u ti·∫øp theo
                setTimeout(() => {
                    currentSentenceIndex++;
                    loadCurrentSentence();
                }, 1500); 

            } else {
                // SAI
                const feedbackEl = $('#feedback-message');
                feedbackEl.textContent = data.feedbackIncorrect;
                feedbackEl.classList.add('text-red-600');
                
                dropZoneContainer.style.animation = 'shake 0.3s';
                setTimeout(() => dropZoneContainer.style.animation = 'none', 300);
            }
        }
        
        function tryAgain() {
            if (currentSentenceIndex >= sentences.length) return; 
            
            const wordBank = $('#word-bank');
            
            // X√≥a t·∫•t c·∫£ c√°c t·ª´ ƒë√£ th·∫£ kh·ªèi √¥ v√† Kho T·ª´
            $$('.word-pill').forEach(pill => pill.remove()); 
            
            // L·∫•y l·∫°i c√°c t·ª´ g·ªëc c·ªßa c√¢u hi·ªán t·∫°i
            const currentItem = sentences[currentSentenceIndex];
            const correctSentence = currentItem.sentence;
            let words = splitSentenceToWords(correctSentence);

            // X√°o tr·ªôn l·∫°i v√† ƒë∆∞a v√†o Kho T·ª´
            shuffleArray(words).forEach(word => {
                const newPill = createWordPill(word);
                wordBank.appendChild(newPill);
            });

            clearFeedback();
        }

        function initGame() {
            updateUI();
            loadCurrentSentence();
            startTimer(); 

            $('#check-button').addEventListener('click', checkAnswer);
            $('#try-again-button').addEventListener('click', tryAgain);
            
            document.addEventListener('dragstart', handleDragStart);
            document.addEventListener('dragend', handleDragEnd);
        }

        window.onload = initGame;
    </script>
</body>
</html>
